<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Payment</title>
        <link rel="stylesheet" href="../css/style.css"/>
        <script src="../js/script.js"></script>
    </head>
    <body>
        <div class="container">
            <div class="box payment-box">
                <h2>Payment Details</h2>
                <form class="form payment-form">
                    <div class="form-field">
                        <label for="cardName">Name on Card</label>
                        <input type="text" id="cardName" name="cardName" required>
                    </div>
                    <div class="form-field">
                        <label for="cardNum">Card Number</label>
                        <input type="text" id="cardNum" name="cardNum" required>
                    </div>
                    <div class="form-field">
                        <label for="expiry">Expiry</label>
                        <input type="text" id="expiry" name="expiry" placeholder="MM/YY" required>
                    </div>
                    <div class="form-field">
                        <label for="cvv">CVV</label>
                        <input type="text" id="cvv" name="cvv" required>
                    </div>
                </form>
                <div class="buttons">
                    <button class="btn submit" onclick="confirmBooking();">Confirm Booking</button>
                    <button class="btn return" onclick="returnHome();">Return Home</button>
                </div>
            </div>
        </div>

        <script>
            const API_URL = 'http://localhost:5000/api';

            function confirmBooking() {
                window.localStorage.setItem('paymentDetails', JSON.stringify({
                    name: document.getElementById('cardName').value,
                    number: document.getElementById('cardNum').value,
                    expiry: document.getElementById('expiry').value,
                    cvv: document.getElementById('cvv').value

                }))

                const postData = {
                    "attraction": JSON.parse(window.localStorage.getItem('selectedAttraction')),
                    "timeSlot": JSON.parse(window.localStorage.getItem('selectedTime')),
                    "tickets": JSON.parse(window.localStorage.getItem('selectedTickets')),
                    "booking": JSON.parse(window.localStorage.getItem('bookingDetails'))
                }

                console.log(postData);
                
                fetch(`${API_URL}/attractions/bookings`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(postData)
                })
            }; 

            function returnHome() {
                window.location.href = 'select-attraction.html';
            }   
        </script>
    </body>
</html>